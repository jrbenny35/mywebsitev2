/*
**
**  jquery.kyco.googleplusfeed
**  ==========================
**
**  Version 2.1.1
**
**  Brought to you by
**  https://www.kycosoftware.com/
**
**  Copyright 2015 Cornelius Weidmann
**
**  Distributed under the GPL
**
*/

(function(h){var l={init:function(b){var a=h.extend({},{feedPosts:3,postsIncrement:3,maxPosts:20,profileImageSize:50,fadeSpeed:250,loadAttachments:!0,orderBy:"date",sort:"asc",lang:"en"},b);return this.each(function(){var b=h(this),l,n,f,z,A,y,t,w,p,x,q;a.lang="en"===a.lang?{langCode:"en",loading:"Loading...",showMore:"Show more",viewMore:"View more posts on Google+",shared:"Shared publicly - ",viewPost:"View post",errorEmpty:"Nothing to show. Empty feed. ",retryEmpty:"Refresh",errorGeneral:"Unable to retrieve feed contents. ",errorNotFound:"User not found... Enter a valid Google+ ID",retryGeneral:"Retry",originalShare:"originally shared",viewVideo:"View video at original URL"}:{langCode:"de",loading:"Wird geladen...",showMore:"Mehr anzeigen",viewMore:"Weitere Beitr\u00e4ge ansehen bei Google+",shared:"\u00d6ffentlich geteilt - ",viewPost:"Beitrag ansehen",errorEmpty:"Nichts zu sehen. Keine Beitr\u00e4ge. ",retryEmpty:"Wiederholen",errorGeneral:"Es ist ein Fehler beim Abrufen der Beitr\u00e4ge aufgetreten. ",errorNotFound:"Benutzer nicht gefunden... Verwende einen g\u00fcltigen Google+ ID",retryGeneral:"Wiederholen",originalShare:"urspr\u00fcnglich geteilt",viewVideo:"Video Blick in Original URL"};l=h('<div id="feed_'+b.attr("class")+'" class="kyco_googleplusfeed '+a.lang.langCode+'"></div>');n=h('<div class="feed_loader">'+a.lang.loading+"</div>");f=h('<div class="feed_wrapper"></div>');z=h('<div class="feed_header"></div>');A=h('<h3 class="feed_screen_name"><a href="#" target="_blank"></a></h3>');y=h('<a href="#" class="feed_profile_image" target="_blank"></a>');t=h('<div class="feed_content"></div>');w=h('<span class="feed_show_more">'+a.lang.showMore+"</span>");p=h('<div class="error"></div>');x=h('<span class="retry"></span>');z.append(y,A);f.append(z,t,w);l.append(n,f);b.append(l);q=new function(b){var d=this;d.id=b;d.url="https://plus.google.com/"+d.id;d.init=function(){function h(a,b){var f=b||!1,d="",g,k,m,d=c[a].publishedDate.substr(0,19);g=d.split("T")[0];m=g.split("-")[0];k="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")["01 02 03 04 05 06 07 08 09 10 11 12".split(" ").indexOf(g.split("-")[1])];g=g.split("-")[2];d=d.split("T").pop();g=g+" "+k+" "+m;return f?g+" "+d:g}function d(e){var b="",f="",k="",g,m,r,v;if(a.loadAttachments&&"undefined"!==typeof c[e].attachments)for(g=0,m=c[e].attachments.length;g<m;g++)switch(f="",c[e].attachments[g].objectType){case "photo":k+='<p class="attachment photo"><a href="'+c[e].attachments[g].url+'" target="_blank" title="View photo"><img width="100%" src="'+c[e].attachments[g].image.url+'"></a></p>';break;case "album":r=0;for(v=c[e].attachments[g].thumbnails.length;r<v;r++)f+='<a href="'+c[e].attachments[g].thumbnails[r].url+'" target="_blank" title="View album"><img width="100%" src="'+c[e].attachments[g].thumbnails[r].image.url+'"></a>';k+='<p class="attachment album">'+f+"</p>";break;case "article":k=c[e].attachments[g].fullImage?k+('<p class="attachment photo"><a href="'+c[e].attachments[g].url+'" target="_blank" title="View article"><img width="100%" src="'+c[e].attachments[g].fullImage.url+'"></a></p>'):k+('<p class="attachment article"><a href="'+c[e].attachments[g].url+'" target="_blank" title="View article"><span title="'+c[e].attachments[g].displayName+'">'+c[e].attachments[g].displayName+'</span><small title="'+c[e].attachments[g].url+'">'+c[e].attachments[g].url+"</small></a></p>");break;case "video":k+='<p class="attachment video"><iframe width="100%" scrolling="no" src="'+c[e].attachments[g].embed.url+'"></iframe><a href="'+c[e].attachments[g].url+'" target="_blank" title="View video">'+a.lang.viewVideo+"</a></p>"}return b="undefined"!==typeof c[e].annotation?b+('<div class="feed_post post_'+(e+1)+'"><span title="'+h(e,!0)+'">'+a.lang.shared+h(e)+"</span><p>"+c[e].annotation+'</p><div class="original"><p class="original">'+c[e].originalPoster.displayName+" <span>"+a.lang.originalShare+":</span></p>"+k+"<p>"+c[e].content+'</p></div><a href="'+c[e].url+'" target="_blank">'+a.lang.viewPost+"</a></div>"):b+('<div class="feed_post post_'+(e+1)+'"><span title="'+h(e,!0)+'">'+a.lang.shared+h(e)+"</span>"+k+"<p>"+c[e].content+'</p><a href="'+c[e].url+'" target="_blank">'+a.lang.viewPost+"</a></div>")}var c=q.entries,b=c.length,k=a.feedPosts,B=a.postsIncrement,u=0,r=!1,l=0,v=k,m="",k=b<k?b:k;if(0<b){for(;l<k;l++)m+=d(l);A.children("a").attr("href",q.url).text(q.screenName);y.attr("href",q.url);y.append('<img src="'+q.image+'" width="'+a.profileImageSize+'" height="'+a.profileImageSize+'">');t.html(m);t.animate({scrollTop:0},1);f.fadeIn(a.fadeSpeed)}else f.children().remove(),p.text(a.lang.errorEmpty),x.text(a.lang.retryEmpty),p.append(x),f.append(p),f.fadeIn(a.fadeSpeed),f.find(".retry").click(function(){f.children().remove();f.append(n);n.show();q.getFeed()});w.click(function(){var e=function(){window.open(q.url)};if(u<=b){u+=r?B:k+B;for(u=u>b?b:u;v<u;v++)m+=d(v),v===b-1&&(w.unbind("click").addClass("link"),w.text(a.lang.viewMore).click(e));t.animate({scrollTop:t[0].scrollHeight},500);r=!0}t.html(m)})};d.getFeed=function(){h.ajax({type:"GET",url:"https://www.kycosoftware.com/api/googleplus-feed/"+d.id,dataType:"json",success:function(b){var l,c,q;try{"404"!==b&&!1!==b?(l=b.profile,c=b.activity,q=function(b){for(var c=[],f=b.length,d=0,h=0;d<f;d++)h<a.maxPosts&&""!==b[d].object.content&&(c.push({url:b[d].object.url,publishedDate:b[d].published,content:b[d].object.content,annotation:b[d].annotation,attachments:b[d].object.attachments,plusones:b[d].object.plusoners.totalItems,originalPoster:b[d].object.actor}),h++);switch(a.orderBy){case "date":c.sort(function(a,b){return new Date(b.publishedDate)-new Date(a.publishedDate)});break;case "popularity":"asc"===a.sort?c.sort(function(a,b){return b.plusones-a.plusones}):c.sort(function(a,b){return a.plusones-b.plusones})}return c},d.screenName=l.displayName,d.entries=q(c.items),d.image=l.image.url.substr(0,l.image.url.indexOf("?"))+"?sz="+a.profileImageSize,h.get(d.image).fail(function(){d.image="https://www.kycosoftware.com/images/general/googleplus-404.png"}).always(function(){h('<img src="'+d.image+'">').load(function(){n.fadeOut(a.fadeSpeed,function(){n.remove();d.init()})})})):"404"===b?n.fadeOut(a.fadeSpeed,function(){p.text(a.lang.errorNotFound);f.html(p);f.fadeIn(a.fadeSpeed)}):n.fadeOut(a.fadeSpeed,function(){p.text(a.lang.errorGeneral);f.html(p);f.fadeIn(a.fadeSpeed)})}catch(k){n.fadeOut(a.fadeSpeed,function(){f.children().remove();p.text(a.lang.errorGeneral);x.text(a.lang.retryGeneral);p.append(x);f.append(p);f.fadeIn(a.fadeSpeed);f.find(".retry").click(function(){f.children().remove();f.append(n);n.show();d.getFeed()})})}}})};d.getFeed()}(a.id)})}};h.fn.kycoGooglePlusFeed2=function(b){var a=b;"string"===typeof b&&(a={id:b});return l[b]?l[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a?l.init.apply(this,[a]):h.error("Method "+b+" does not exist on jQuery.kycoGooglePlusFeed2")}})(jQuery);
